<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">test/Emitter.spec.js | RegExp Events</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A simple RegExp event emitter"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="RegExp Events"><meta property="twitter:description" content="A simple RegExp event emitter"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/rdfriedl/regexp-events"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Emitter.js~Emitter.html">Emitter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Event.js~Event.html">Event</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-clearListeners">clearListeners</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isRegExpEqual">isRegExpEqual</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">test/Emitter.spec.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import Emitter from &quot;../src/Emitter&quot;;
import Event from &quot;../src/Event&quot;;
import { isRegExpEqual } from &quot;../src/utils&quot;;

function expectListenerCount(emitter, type, count, useRegExp = true) {
	expect(emitter).to.exist;
	expect(emitter.eventMap).to.be.an.instanceof(Map);
	if (typeof type === &quot;string&quot;) {
		if (count === 0) {
			expect(emitter.eventMap.size).to.equal(0);
		} else {
			expect(emitter.eventMap.get(type)).to.exist;
			if (emitter.eventMap.get(type)) expect(emitter.eventMap.get(type)).to.have.lengthOf(count);
		}
	} else if (type instanceof RegExp) {
		let total = 0;
		emitter.eventMap.forEach((listeners, listenersEventType) =&gt; {
			if (typeof listenersEventType === &quot;string&quot; &amp;&amp; useRegExp &amp;&amp; type.test(listenersEventType))
				total += listeners.length;
			else if (isRegExpEqual(listenersEventType, type)) total += listeners.length;
		});
		expect(total).to.equal(count);
	} else {
		if (count === 0) {
			expect(emitter.eventMap.size).to.equal(0);
		} else {
			let total = 0;
			emitter.eventMap.forEach(listeners =&gt; (total += listeners.length));
			expect(total).to.equal(count);
		}
	}
}

describe(&quot;Emitter&quot;, () =&gt; {
	let emitter, listener;

	beforeEach(() =&gt; {
		emitter = new Emitter();
		listener = sinon.stub();
	});

	describe(&quot;createEventMap&quot;, () =&gt; {
		it(&quot;should create an eventMap if one dose not exist&quot;, () =&gt; {
			Emitter.events = null;

			Emitter.createEventMap(emitter);

			expect(Emitter.events).to.exist;
		});

		it(&quot;should not create a new events map if one exists&quot;, () =&gt; {
			let events = Emitter.events;

			Emitter.createEventMap(emitter);

			expect(Emitter.events).to.equal(events);
		});
	});

	describe(&quot;removeEventMap&quot;, () =&gt; {
		it(&quot;should not create an eventMap if one dose not exist&quot;, () =&gt; {
			Emitter.events = null;

			Emitter.removeEventMap(emitter);

			expect(Emitter.events).to.be.null;
		});
	});

	describe(&quot;on&quot;, () =&gt; {
		it(&quot;(String, Function)&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.be.undefined;
			expect(data.isStatic).to.equal(false);
			expect(data.times).to.equal(Infinity);
		});

		it(&quot;(String, Function, context)&quot;, () =&gt; {
			let context = {};
			emitter.on(&quot;test&quot;, listener, context);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.equal(context);
			expect(data.isStatic).to.equal(false);
			expect(data.times).to.equal(Infinity);
		});
		it(&quot;(String, Function, context, times)&quot;, () =&gt; {
			let context = {};
			emitter.on(&quot;test&quot;, listener, context, 10);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.equal(context);
			expect(data.isStatic).to.equal(false);
			expect(data.times).to.equal(10);
		});
		it(&quot;(String, Function, context, times, isStatic)&quot;, () =&gt; {
			let context = {};
			emitter.on(&quot;test&quot;, listener, context, 10, true);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.equal(context);
			expect(data.isStatic).to.equal(true);
			expect(data.times).to.equal(10);
		});
		it(&quot;(String, Function, context, isStatic)&quot;, () =&gt; {
			let context = {};
			emitter.on(&quot;test&quot;, listener, context, true);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.equal(context);
			expect(data.isStatic).to.equal(true);
			expect(data.times).to.equal(Infinity);
		});
		it(&quot;(String, Function, context, isStatic, times)&quot;, () =&gt; {
			let context = {};
			emitter.on(&quot;test&quot;, listener, context, true, 10);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.equal(context);
			expect(data.isStatic).to.equal(true);
			expect(data.times).to.equal(10);
		});

		it(&quot;(String, Function, isStatic)&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener, true);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.be.undefined;
			expect(data.isStatic).to.equal(true);
			expect(data.times).to.equal(Infinity);
		});
		it(&quot;(String, Function, isStatic, context)&quot;, () =&gt; {
			let context = {};
			emitter.on(&quot;test&quot;, listener, true, context);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.equal(context);
			expect(data.isStatic).to.equal(true);
			expect(data.times).to.equal(Infinity);
		});
		it(&quot;(String, Function, isStatic, times)&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener, true, 10);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.be.undefined;
			expect(data.isStatic).to.equal(true);
			expect(data.times).to.equal(10);
		});
		it(&quot;(String, Function, isStatic, context, times)&quot;, () =&gt; {
			let context = {};
			emitter.on(&quot;test&quot;, listener, true, context, 10);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.equal(context);
			expect(data.isStatic).to.equal(true);
			expect(data.times).to.equal(10);
		});
		it(&quot;(String, Function, isStatic, times, context)&quot;, () =&gt; {
			let context = {};
			emitter.on(&quot;test&quot;, listener, true, 10, context);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.equal(context);
			expect(data.isStatic).to.equal(true);
			expect(data.times).to.equal(10);
		});

		it(&quot;(String, Function, times)&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener, 10);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.be.undefined;
			expect(data.isStatic).to.equal(false);
			expect(data.times).to.equal(10);
		});
		it(&quot;(String, Function, times, context)&quot;, () =&gt; {
			let context = {};
			emitter.on(&quot;test&quot;, listener, 10, context);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.equal(context);
			expect(data.isStatic).to.equal(false);
			expect(data.times).to.equal(10);
		});
		it(&quot;(String, Function, times, isStatic)&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener, 10, true);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.be.undefined;
			expect(data.isStatic).to.equal(true);
			expect(data.times).to.equal(10);
		});
		it(&quot;(String, Function, times, context, isStatic)&quot;, () =&gt; {
			let context = {};
			emitter.on(&quot;test&quot;, listener, 10, context, true);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.equal(context);
			expect(data.isStatic).to.equal(true);
			expect(data.times).to.equal(10);
		});
		it(&quot;(String, Function, times, isStatic, context)&quot;, () =&gt; {
			let context = {};
			emitter.on(&quot;test&quot;, listener, 10, true, context);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.ctx).to.equal(context);
			expect(data.isStatic).to.equal(true);
			expect(data.times).to.equal(10);
		});

		it(&quot;(RegExp, Function)&quot;, () =&gt; {
			let regexp = /test\d/;
			emitter.on(regexp, listener);
			expectListenerCount(emitter, regexp, 1);

			let data = emitter.eventMap.get(regexp)[0];
			expect(data.func).to.equal(listener);
		});

		it(&quot;(Event, Function)&quot;, () =&gt; {
			emitter.on(new Event(&quot;test&quot;), listener);
			expectListenerCount(emitter, &quot;test&quot;, 1);

			let data = emitter.eventMap.get(&quot;test&quot;)[0];
			expect(data.func).to.equal(listener);
		});

		it(&quot;() throws if there is no event type&quot;, () =&gt; {
			expect(() =&gt; {
				emitter.on();
			}).to.throw(Error);
		});

		it(&quot;(Number|Null|Function) throws if the eventType is not a String, Event or RegExp&quot;, () =&gt; {
			expect(() =&gt; {
				emitter.on(10);
			}).to.throw(Error);

			expect(() =&gt; {
				emitter.on(listener);
			}).to.throw(Error);

			expect(() =&gt; {
				emitter.on(Null);
			}).to.throw(Error);
		});

		it(&quot;(String) throws if listener function is no provided&quot;, () =&gt; {
			expect(() =&gt; {
				emitter.on(&quot;testing&quot;);
			}).to.throw(Error);
		});

		it(&quot;(String, Null) throws if listener is not a function&quot;, () =&gt; {
			expect(() =&gt; {
				emitter.on(&quot;testing&quot;, 50);
			}).to.throw(Error);
		});
	});

	describe(&quot;off&quot;, () =&gt; {
		it(&quot;only removes the first listener that matches&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test&quot;, listener);
			emitter.off(&quot;test&quot;, listener);
			expectListenerCount(emitter, &quot;test&quot;, 1);
		});

		it(&quot;(String, Function) removes listener&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.off(&quot;test&quot;, listener);
			expectListenerCount(emitter, &quot;test&quot;, 0);
		});
		it(&quot;(String, Function) dose not remove static listener&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener, true);
			emitter.off(&quot;test&quot;, listener);
			expectListenerCount(emitter, &quot;test&quot;, 1);
		});

		it(&quot;(String, Function, context) removes listener with context&quot;, () =&gt; {
			let ctx = {};
			emitter.on(&quot;test&quot;, listener, ctx);
			emitter.off(&quot;test&quot;, listener, ctx);
			expectListenerCount(emitter, &quot;test&quot;, 0);
		});

		it(&quot;(String, Function) dost not remove listener with different context&quot;, () =&gt; {
			let ctx = {};
			let ctx2 = {};
			emitter.on(&quot;test&quot;, listener, ctx);
			emitter.on(&quot;test&quot;, listener, ctx2);
			emitter.off(&quot;test&quot;, listener, ctx);
			expectListenerCount(emitter, &quot;test&quot;, 1);
		});

		it(&quot;(Event, Function) removes listener&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.off(new Event(&quot;test&quot;), listener);
			expectListenerCount(emitter, &quot;test&quot;, 0);
		});

		it(&quot;(RegExp, Function) removes listener&quot;, () =&gt; {
			let regexp = /test.*/;
			emitter.on(regexp, listener);
			emitter.off(regexp, listener);
			expectListenerCount(emitter, regexp, 0);
		});

		it(&quot;(String, Function, force=true) removes static listener&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener, true);
			emitter.off(&quot;test&quot;, listener, true);
			expectListenerCount(emitter, &quot;test&quot;, 0);
		});
		it(&quot;(String, Function, force=false) dose not remove static listener&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener, true);
			emitter.off(&quot;test&quot;, listener, false);
			expectListenerCount(emitter, &quot;test&quot;, 1);
		});

		it(&quot;(String, Function, context, force=true) removes static listener&quot;, () =&gt; {
			let ctx = {};
			emitter.on(&quot;test&quot;, listener, ctx, true);
			emitter.off(&quot;test&quot;, listener, ctx, true);
			expectListenerCount(emitter, &quot;test&quot;, 0);
		});
		it(&quot;(String, Function, context, force=false) dose not remove static listener&quot;, () =&gt; {
			let ctx = {};
			emitter.on(&quot;test&quot;, listener, ctx, true);
			emitter.off(&quot;test&quot;, listener, ctx, false);
			expectListenerCount(emitter, &quot;test&quot;, 1);
		});

		it(&quot;(String, Function, force=true, context) removes static listener&quot;, () =&gt; {
			let ctx = {};
			emitter.on(&quot;test&quot;, listener, true, ctx);
			emitter.off(&quot;test&quot;, listener, true, ctx);
			expectListenerCount(emitter, &quot;test&quot;, 0);
		});
		it(&quot;(String, Function, force=false, context) dose not remove static listener&quot;, () =&gt; {
			let ctx = {};
			emitter.on(&quot;test&quot;, listener, true, ctx);
			emitter.off(&quot;test&quot;, listener, false, ctx);
			expectListenerCount(emitter, &quot;test&quot;, 1);
		});
	});

	describe(&quot;clear&quot;, () =&gt; {
		it(&quot;() removes all listeners&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test2&quot;, listener);
			emitter.clear();
			expectListenerCount(emitter, &quot;test&quot;, 0);
			expectListenerCount(emitter, &quot;test2&quot;, 0);
		});

		it(&quot;() dose not remove static listeners&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test&quot;, listener, true);
			emitter.clear();
			expectListenerCount(emitter, &quot;test&quot;, 1);
		});

		it(&quot;(force=true) removes static listeners&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test&quot;, listener, true);
			emitter.clear(true);
			expectListenerCount(emitter, &quot;test&quot;, 0);
		});

		it(&quot;(force=false) dose not remove static listeners&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test&quot;, listener, true);
			emitter.clear(false);
			expectListenerCount(emitter, &quot;test&quot;, 1);
		});

		it(&quot;(String) removes all listeners of type&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test&quot;, listener);
			emitter.clear(&quot;test&quot;);
			expectListenerCount(emitter, &quot;test&quot;, 0);
		});

		it(&quot;(String, force=true) removes static listeners of type&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test&quot;, listener, true);
			emitter.clear(&quot;test&quot;, true);
			expectListenerCount(emitter, &quot;test&quot;, 0);
		});

		it(&quot;(String, force=false) dose not remove static listeners of type&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test&quot;, listener, true);
			emitter.clear(&quot;test&quot;, false);
			expectListenerCount(emitter, &quot;test&quot;, 1);
		});

		it(&quot;(Event) removes all listeners of event type&quot;, () =&gt; {
			emitter.on(new Event(&quot;test&quot;), listener);
			emitter.on(&quot;test&quot;, listener);
			emitter.clear(new Event(&quot;test&quot;));
			expectListenerCount(emitter, &quot;test&quot;, 0);
		});

		it(&quot;(RegExp) removes listeners with matching String or same RegExp&quot;, () =&gt; {
			emitter.on(/test\d/, listener);
			emitter.on(&quot;test10&quot;, listener);
			emitter.clear(/test\d/);
			expectListenerCount(emitter, &quot;test10&quot;, 0);
			expectListenerCount(emitter, /test\d/, 0, false);
		});

		it(&quot;(RegExp, force=false, useRegexp=false) only removes matching RegExp&quot;, () =&gt; {
			emitter.on(/test\d/, listener);
			emitter.on(&quot;test10&quot;, listener);
			emitter.clear(/test\d/, false, false);
			expectListenerCount(emitter, &quot;test10&quot;, 1);
			expectListenerCount(emitter, /test\d/, 0, false);
		});

		it(&quot;(RegExp, force=false, useRegexp=false) takes RegExp flags into account when comparing regexes&quot;, () =&gt; {
			emitter.on(/test\d/i, listener);
			emitter.clear(/test\d/, false, false);
			expectListenerCount(emitter, /test\d/i, 1, false);
			emitter.clear(/test\d/i, false, false);
			expectListenerCount(emitter, /test\d/i, 0, false);
		});
	});

	describe(&quot;count&quot;, () =&gt; {
		it(&quot;should return 0 if eventMap has not been created yet&quot;, () =&gt; {
			Emitter.events = null;

			expect(emitter.count(&quot;testing&quot;)).to.equal(0);
		});

		it(&quot;() returns total number of all listeners on the emitter&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test2&quot;, listener);
			expect(emitter.count()).to.equal(2);
		});

		it(&quot;(String) returns number of listeners of that type&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test2&quot;, listener);
			expect(emitter.count(&quot;test&quot;)).to.equal(2);
		});

		it(&quot;(Event) returns number of listeners of Event.type&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test2&quot;, listener);
			expect(emitter.count(new Event(&quot;test&quot;))).to.equal(2);
		});

		it(&quot;(RegExp) returns number of listeners that match the RegExp&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test&quot;, listener);
			emitter.on(&quot;test2&quot;, listener);
			emitter.on(&quot;test3&quot;, listener);
			emitter.on(&quot;test10&quot;, listener);
			expect(emitter.count(/test\d/)).to.equal(3);
			expect(emitter.count(/.*/)).to.equal(5);
		});

		it(&quot;(RegExp, useRegExp=false) returns number of listeners that have a identical RegExp&quot;, () =&gt; {
			emitter.on(/test\d/g, listener);
			emitter.on(/test\d/, listener);
			emitter.on(&quot;test10&quot;, listener);
			expect(emitter.count(/test\d/, false)).to.equal(1);
			expect(emitter.count(/test\d/g, false)).to.equal(1);
		});
	});

	describe(&quot;once&quot;, () =&gt; {
		it(&quot;removes listener after the event is fired&quot;, () =&gt; {
			emitter.once(&quot;test&quot;, listener);
			emitter.emit(&quot;test&quot;);
			expect(listener).to.have.been.called;
			expectListenerCount(emitter, &quot;test&quot;, 0);
		});
	});

	describe(&quot;emit&quot;, () =&gt; {
		it(&quot;throws error if eventType is not a string&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			expect(() =&gt; {
				emitter.emit(null);
			}).to.throw(Error);
		});

		it(&quot;(String) calls listeners&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.emit(&quot;test&quot;);
			expect(listener).to.have.been.called;
		});

		it(&quot;(String, args...) calls listeners with arguments&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.emit(&quot;test&quot;, 1, 2, 3);
			expect(listener).to.have.been.calledWith(1, 2, 3);
		});

		it(&quot;(String, args...) passes the Event as the last arguments&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, (...args) =&gt; {
				expect(args[args.length - 1]).to.be.an.instanceof(Event);
			});
			emitter.emit(&quot;test&quot;, 1, 2, 3);
		});

		it(&quot;(Event) calls listeners&quot;, () =&gt; {
			emitter.on(new Event(&quot;test&quot;), listener);
			emitter.emit(&quot;test&quot;);
			expect(listener).to.have.been.called;
		});

		it(&quot;(Event) emits the Event that is passed in&quot;, () =&gt; {
			let event = new Event(&quot;test&quot;);
			emitter.on(&quot;test&quot;, listener);
			emitter.emit(event);
			expect(listener).to.have.been.calledWithExactly(event);
		});

		it(&quot;(Event) calls listeners with Event.args&quot;, () =&gt; {
			let event = new Event(&quot;test&quot;, [1, 2, 3]);
			emitter.on(&quot;test&quot;, listener);
			emitter.emit(event);
			expect(listener).to.have.been.calledWithExactly(1, 2, 3, event);
		});

		it(&quot;(Event) sets Event.target if its not already set&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);

			let event = new Event(&quot;test&quot;, [1, 2, 3]);
			emitter.emit(event);
			expect(event.target).to.equal(emitter);

			let target = {};
			event = new Event(&quot;test&quot;, [1, 2, 3], target);
			emitter.emit(event);
			expect(event.target).to.equal(target);
		});

		it(&quot;dost not fire the event if Emitter.suppressEvents == true&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener);
			emitter.suppressEvents = true;
			emitter.emit(&quot;test&quot;);
			expect(listener).not.to.have.been.called;
		});

		it(&quot;removes listener after calling is the correct number of times&quot;, () =&gt; {
			emitter.on(&quot;test&quot;, listener, undefined, false, 10);
			for (let i = 0; i &lt; 20; i++) emitter.emit(&quot;test&quot;);

			expect(listener).to.have.callCount(10);
		});
	});

	describe(&quot;dispose&quot;, () =&gt; {
		it(&quot;should call Emitter.removeEventMap&quot;, () =&gt; {
			sinon.spy(Emitter, &quot;removeEventMap&quot;);

			emitter.dispose();

			expect(Emitter.removeEventMap).to.have.been.called;
		});
	});
});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
